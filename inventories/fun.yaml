# This is an example inventory, feel free to modify it given your needs an
# constraints.
#
# Note that host names should be resolvable DNS entries. If you don't have
# permissions to modify those entries, feel free to add an `ansible_host` key
# to each hosts entry, e.g.:
#
# hosts:
#   la-stack-es-master-01:
#     ansible_host: www.xxx.yyy.zzz
#
# You must also add the reserved variable in the roles config, e.g.:
#
# elasticsearch:
#   vars:
#     es_config:
#       discovery.seed_hosts: "{{ hostvars[groups['es-master-nodes'][0]]['ansible_host'] }}:9300"

all:
  # Common vars for all hosts
  vars:
    ansible_user: root
    debian_common_admin_user_authorized_keys:
      # paste authorized ssh keys

  children:
    # Elasticsearch nodes
    elasticsearch:
      children:
        es-master-nodes:
          hosts:
            la-stack-es-master-01:
          vars:
            es_config_host:
              node.master: true
              node.data: false
        es-data-nodes:
          hosts:
            la-stack-es-data-01:
            la-stack-es-data-02:
          vars:
            es_config_host:
              node.master: false
              node.data: true
      vars:
        firewall_allowed_ports: ["22", "9300", "9200"]
        es_config:
          node.name: "{{ inventory_hostname }}"
          cluster.name: "test-cluster"
          discovery.seed_hosts: "{{ hostvars[groups['es-master-nodes'][0]] }}:9300"
          cluster.initial_master_nodes: "{{ hostvars[groups['es-master-nodes'][0]]['inventory_hostname'] }}"
          http.host: 0.0.0.0
          http.port: 9200
          transport.host: 0.0.0.0
          transport.port: 9300
          bootstrap.memory_lock: true
          xpack.security.authc.realms.file.file1.order: 0
          xpack.security.authc.realms.native.native1.order: 1
        es_heap_size: 1g
        es_enable_http_ssl: true
        es_enable_transport_ssl: true
        es_ssl_keystore: "./elastic-tls/keystore/{{ inventory_hostname }}/{{ inventory_hostname }}.p12"
        es_ssl_truststore: "./elastic-tls/my-ca.p12"

    # Grafana servers
    grafana:
      hosts:
        la-stack-grafana-web-00:
      vars:
        firewall_allowed_ports: ["22", "3000"]
        grafana_datasources:
          - name: Elastic
            type: elasticsearch
            access: proxy
            database: "[metrics-]YYYY.MM.DD"
            url: "https://{{ hostvars[groups['es-master-nodes'][0]] }}:9200"
            basicAuth: true
            jsonData:
              tlsSkipVerify: true

    # Ralph LRS servers
    ralph:
      hosts:
        la-stack-ralph-00:
      vars:
        firewall_allowed_ports: ["22"]
        pyenv_owner: admin
        pyenv_virtualenvs:
          - venv_name: ralph_venv
            py_version: 3.9.15
